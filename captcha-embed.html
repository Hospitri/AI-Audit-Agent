<script
    src="https://challenges.cloudflare.com/turnstile/v0/api.js"
    async
    defer></script>

<div id="cf-ts" style="display: none"></div>

<script>
    (function () {
        function ready(fn) {
            document.readyState !== 'loading'
                ? fn()
                : document.addEventListener('DOMContentLoaded', fn);
        }

        function findForm() {
            let f = document.querySelector('form[action*="/api/audit"]');
            if (f) return f;
            const forms = document.getElementsByTagName('form');
            if (forms && forms.length) return forms[0];
            return null;
        }

        ready(function () {
            let tries = 0;
            const iv = setInterval(function () {
                const form = findForm();
                if (!form) {
                    if (++tries < 50) return;
                    clearInterval(iv);
                    return;
                }
                clearInterval(iv);

                let hidden = form.querySelector(
                    'input[name="cf-turnstile-response"]'
                );
                if (!hidden) {
                    hidden = document.createElement('input');
                    hidden.type = 'hidden';
                    hidden.name = 'cf-turnstile-response';
                    form.appendChild(hidden);
                }

                function mount() {
                    if (!window.turnstile) return setTimeout(mount, 100);
                    const widgetId = turnstile.render('#cf-ts', {
                        sitekey: '0x4AAAAAABtV7qHp_xYyfRtC',
                        size: 'invisible',
                        callback: function (token) {
                            hidden.value = token;
                            form.submit();
                        },
                    });

                    form.addEventListener(
                        'submit',
                        function (e) {
                            if (hidden.value) return;
                            e.preventDefault();
                            turnstile.execute(widgetId);
                        },
                        true
                    );
                }
                mount();
            }, 100);
        });
    })();
</script>
